# Copyright 2022 TOSIT.IO
# SPDX-License-Identifier: Apache-2.0

---
# Airflow Version
airflow_version: 2.2.5

# Airflow directory
airflow_root_dir: /opt/tdp/airflow
airflow_install_dir: "{{ airflow_root_dir }}/airflow"
airflow_root_conf_dir: /etc/airflow
airflow_certs_folder: "{{ airflow_root_conf_dir }}/certs"
airflow_dag_dir: "{{ airflow_install_dir }}/dags"
airflow_env_file: /etc/sysconfig/airflow
hadoop_conf_dir: /etc/hadoop/conf
airflow_scheduler_logs: "{{ airflow_log_dir }}/scheduler"
# Airflow pid directories
airflow_pid_dir: /run/airflow

# Airflow users and group
airflow_user: airflow
airflow_group: airflow

# Airflow database
airflow_db_user: airflow
airflow_db_pass: airflow
airflow_db_host: master-03
airflow_db_port: 5432
airflow_db_name: airflow
aitflow_sql_alchemy_conn: "postgresql+psycopg2://{{ airflow_db_user }}:{{ airflow_db_pass }}@{{ airflow_db_host }}:{{ airflow_db_port }}/{{ airflow_db_name }}"

# Airflow admin user
airflow_admin_user: admin
airflow_admin_pass: admin123

# Airflow log dir
airflow_log_dir: /var/log/airflow

# Airflow config
airflow_executor: CeleryExecutor
airflow_result_backend: "db+postgresql://{{ airflow_db_user }}:{{ airflow_db_pass }}@{{ airflow_db_host }}:{{ airflow_db_port }}/{{ airflow_db_name }}"
airflow_broker_url: "redis://master-01:6379/0"

#SSL configuration
certificates_path: /etc/ssl/certs
certificates_cert_filename: "{{ ansible_fqdn }}"
certificates_ca_filename: "tdp_ca"
certificates_public_key: "{{ certificates_path }}/{{ certificates_cert_filename }}.pem"
certificates_private_key: "{{ certificates_path }}/{{ certificates_cert_filename }}.key"
certificates_ca: "{{ certificates_path }}/{{ certificates_ca_filename }}.crt" 
airflow_public_key: "{{ airflow_certs_folder }}/{{ certificates_cert_filename }}.pem"
airflow_private_key: "{{ airflow_certs_folder }}/{{ certificates_cert_filename }}.key"
ca_certificate_file: "{{ airflow_certs_folder }}/{{ certificates_ca_filename }}.crt"

ssl_certificate: "{{ airflow_public_key }}"
ssl_private_key: "{{ airflow_private_key }}"

# Redis configuration
redis_bind_address: 0.0.0.0

# Hive Connector
# hive_extra_config: >-
#   {
#     "auth": "KERBEROS",
#     "kerberos_service_name": "hive",
#     "principal": "hive/_HOST@REALM.TDP",
#     "transport_mode": "http",
#     "http_path": "cliservice",
#     "use_ssl": "true",
#     "ssl_trust_store": "/etc/ssl/certs/truststore.jks",
#     "trust_store_password": "Truststore123!"
#   }
# Airflow admin user


airflow_admin:
  - name: Admin
    username: admin
    password: admin123
    role: Admin
    firstname: admin
    lastname: admin
    email: admin@tdp

airflow_users:
  - name: tdp_user
    username: tdp_user
    password: tdp_user123
    role: User
    firstname: tdp_user
    lastname: tdp_user
    email: tdp_user@tdp

hive_extra_config: >-
  {
    "use_beeline": "true", 
    "proxy_user": "login",
    "principal": "hive/master-03.tdp@REALM.TDP;transportMode=http;httpPath=cliservice;ssl=true;sslTrustStore=/etc/ssl/certs/truststore.jks;trustStorePassword=Truststore123!"
  }

spark_extra_config: >-
  {
    "use_beeline": "true", 
    "proxy_user": "tdp_user",
    "principal": "hive/master-03.tdp@REALM.TDP;transportMode=http;httpPath=cliservice;ssl=true;sslTrustStore=/etc/ssl/certs/truststore.jks;trustStorePassword=Truststore123!"
  }

# Kerberos
realm: TDP.LOCAL
krb_create_principals_keytabs: true

